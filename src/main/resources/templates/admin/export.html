<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f9f4e8;
        color: #333;
        margin: 0;
        padding: 0;
    }

    h2 {
        color: #c09b5a;
        text-align: center;
        padding-top: 20px;
    }

    input[type="text"] {
        padding: 8px;
        border: 1px solid #c09b5a;
        border-radius: 4px;
        width: 200px;
        margin-right: 10px;
    }

    button {
        padding: 8px 16px;
        background-color: #6B8E23;
        border: none;
        color: white;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    button:hover {
        background-color: #b38a48;
    }

    select {
        padding: 8px;
        border: 1px solid #c09b5a;
        border-radius: 4px;
        background-color: white;
    }

    table {
        width: 100%;
        margin: 20px auto;
        border-collapse: collapse;
    }

    table th, table td {
        padding: 10px;
        text-align: left;
        border: 1px solid #ccc;
    }

    table th {
        background-color: #c09b5a;
        color: white;
    }

    #pagination {
        text-align: center;
        margin-top: 20px;
    }

    #pagination button {
        padding: 8px 16px;
        background: linear-gradient(135deg, #c09b5a, #e3c27d);
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin: 0 5px;
    }

    #pagination button:hover {
        background-color: #b38a48;
    }

    #emailSuggestions {
        border: 1px solid #6B8E23;
        border-radius: 4px;
        max-height: 150px;
        overflow-y: auto;
        position: absolute;
        background-color: white;
        width: 200px;
        z-index: 10;
    }

    #emailSuggestions li {
        padding: 8px;
        cursor: pointer;
    }

    #emailSuggestions li:hover {
        background-color: #f0e6d2;
    }

    .btn-primary {
        background-color: #c09b5a;
        color: white;
        padding: 8px 16px;
        text-decoration: none;
        border-radius: 4px;
        transition: background-color 0.3s;
    }

    .btn-primary:hover {
        background-color: #b38a48;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    .btn-primary {
        background-color: rgb(0, 255, 0);
        color: white;
        padding: 8px 16px;
        text-decoration: none;
        border-radius: 4px;
        transition: background-color 0.3s, transform 0.2s; /* Added transition for scaling effect */
    }

    .btn-primary:hover {
        background-color: #b38a48;
        transform: scale(1.05); /* Slightly enlarges the button when hovered */
    }
</style>
<head>
    <title>Xuất file Excel</title>
    <link rel="icon" href="https://lavelasaigon.com/wp-content/uploads/2023/01/main-logo.png" type="image/png">
    <script th:inline="javascript">
        let currentPage = 1;
        let rowsPerPage = 5;
        let originalBookDetails = /*[[${bookDetails}]]*/ []; // Lưu dữ liệu gốc
        let bookDetails = [...originalBookDetails]; // Sử dụng bản sao để hiển thị

        function renderTable() {
            const startIndex = (currentPage - 1) * rowsPerPage;
            const endIndex = startIndex + rowsPerPage;
            const pageDetails = bookDetails.slice(startIndex, endIndex);

            const tbody = document.getElementById("bookDetailsBody");
            tbody.innerHTML = "";

            pageDetails.forEach(detail => {
                const row = document.createElement("tr");
                detail.forEach(value => {
                    const cell = document.createElement("td");
                    cell.textContent = value != null ? value : "";
                    row.appendChild(cell);
                });
                tbody.appendChild(row);
            });

            document.getElementById("pageNumber").textContent = `Trang ${currentPage}`;
        }

        function updateRowsPerPage() {
            rowsPerPage = parseInt(document.getElementById("rowsPerPage").value);
            currentPage = 1;
            renderTable();
        }

        function nextPage() {
            if ((currentPage * rowsPerPage) < bookDetails.length) {
                currentPage++;
                renderTable();
            }
        }

        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                renderTable();
            }
        }

        // Tìm kiếm và hiển thị gợi ý email
        function searchEmailSuggestions() {
            const searchValue = document.getElementById("emailSearch").value.toLowerCase();
            const suggestions = document.getElementById("emailSuggestions");
            suggestions.innerHTML = "";

            if (searchValue) {
                // Kiểm tra xem có phải đang nhập @ hay không
                if (searchValue.includes('@')) {
                    // Thêm gợi ý chữ "all"
                    const allOption = document.createElement("li");
                    allOption.textContent = "@all";
                    allOption.onclick = () => selectEmail("@all");
                    suggestions.appendChild(allOption);
                }

                // Lọc email theo tìm kiếm
                const filteredEmails = Array.from(new Set(
                    originalBookDetails
                        .map(detail => detail[0]) // Assuming email is the second element in each detail
                        .filter(email => email.toLowerCase().includes(searchValue))
                ));

                // Thêm các email vào danh sách gợi ý
                filteredEmails.forEach(email => {
                    const li = document.createElement("li");
                    li.textContent = email;
                    li.onclick = () => selectEmail(email); // Chọn email khi nhấn vào gợi ý
                    suggestions.appendChild(li);
                });

                suggestions.style.display = "block";
            } else {
                suggestions.style.display = "none";
            }
        }


        function selectEmail(email) {
            document.getElementById("emailSearch").value = email;
            document.getElementById("emailSuggestions").style.display = "none";
        }

        function performSearch() {
            const searchValue = document.getElementById("emailSearch").value.toLowerCase();
            if (searchValue === "@all") {
                bookDetails = [...originalBookDetails];
            } else if (searchValue) {
                bookDetails = originalBookDetails.filter(detail => detail[0].toLowerCase().includes(searchValue));
            } else {
                bookDetails = [...originalBookDetails];
            }
            currentPage = 1;
            renderTable();
            document.getElementById("emailSuggestions").style.display = "none";
        }


        document.addEventListener("DOMContentLoaded", () => {
            renderTable();
        });



    </script>
</head>
<body>

<div th:replace="~{access/navadmin :: html}"></div>


<h2>Danh sách khách hàng đã đặt phòng</h2>

<label for="emailSearch">Tìm kiếm theo Email:</label>
<input type="text" id="emailSearch" placeholder="Nhập email..." oninput="searchEmailSuggestions()">
<button onclick="performSearch()">Search</button>
<ul id="emailSuggestions" style="border: 1px solid #ccc; max-height: 150px; overflow-y: auto; display: none; position: absolute; background: white; width: 200px;"></ul>

<label for="rowsPerPage">Số dòng mỗi trang:</label>
<select id="rowsPerPage" onchange="updateRowsPerPage()">
    <option value="5">5</option>
    <option value="10">10</option>
    <option value="20">20</option>
</select>


<table>
    <thead>
    <tr>

        <th>Email</th>
        <th>Ngày vào</th>
        <th>Ngày ra</th>

        <th>Giá</th>
        <th>Tổng</th>
        <th>Phương thức thanh toán</th>
        <th>Payment Status</th>
        <th>Booking Status</th>
        <th>Updated At</th>
        <th>Updated By</th>
        <th>Create By</th>
        <th>Book Code</th>
    </tr>
    </thead>
    <tbody id="bookDetailsBody">
    </tbody>
</table>

<div id="pagination">
    <button onclick="previousPage()">Trang trước</button>
    <span id="pageNumber"></span>
    <button onclick="nextPage()">Trang sau</button>
</div>
<a href="/search/export" class="btn-primary">Xuất sang file Excel</a>

<div th:replace="~{access/error :: footer}"></div>
</body>
</html>
